<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marca</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <div class="container">

        <h1>Adicionar Marca:</h1>

        <form id="form" class="border-circle">

            <div class="row align-items-center">
                <div class="form-floating col-auto">
                    <input type="hidden" name="id" id="id">
                    <input type="text" class="form-control" name="name" id="name" placeholder="" required>
                    <label for="name">Nome: </label>
                </div>
                <div class="col-auto">
                    <button class="btn btn-primary" type="submit" value="create" id="btn-save">Cadastrar</button>
                </div>
                <div class="col-auto">
                    <button class="btn btn-danger d-none" type="button" id="btn-cancel">Cancelar</button>
                </div>
            </div>

        </form>

        <h1>Marcas:</h1>
        <table class="table table-striped table-bordered">
            <thead class="border">
                <tr>
                    <th scope="col">
                        ID
                    </th>
                    <th scope="col">
                        Nome
                    </th>
                    <th scope="col">
                    </th>
                    <th scope="col">

                    </th>
                </tr>
            </thead>
            <tbody id="brands">
            </tbody>
        </table>
    </div>

    <script>

        function createBrand() {
            $.ajax({
                url: 'http://localhost:8080/api/brand',
                method: 'POST',
                data: $("#form").serialize()
            }).done(
                function () {
                    alert("Marca cadastrada")
                    getBrands();
                }
            ).fail(function (xhr, status, error) {
                let message = "Erro desconhecido";
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    message = xhr.responseJSON.message;
                } else if (xhr.responseText) {
                    message = xhr.responseText;
                }
                alert("Erro ao salvar marca: " + message);
            })
        }


        function getBrands() {
            $.ajax({
                url: 'http://localhost:8080/api/brand/all',
                method: "GET",
            }
            ).done(
                function (data) {

                    $('#brands').empty()

                    if (data.length > 0) {

                        for (i = 0; i < data.length; i++) {
                            let brand = data[i]
                            $('#brands').append(`<tr>
                    <th scope="col">
                        <div>${brand.id}</div>
                    </th>
                    <th scope="col">
                        ${brand.name}
                    </th>
                    <th scope="col" class="text-center">
                        <button class="btn border btn-update" brand="${brand.id}">
                            <i class="fa-solid fa-pen-to-square"></i>
                        </button>
                    </th>
                    <th scope="col" class="text-center">
                        <button class="btn border btn-delete" brand="${brand.id}">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </th>
                </tr>`)
                        }
                    }
                }
            )
        }

        function updateForm(brandId) {

            $.ajax({
                url: `http://localhost:8080/api/brand/${brandId}`,
                method: 'GET',
            }).done(
                function (data) {
                    if (data != null) {

                        if ($('#id').val() == '' || $('#id').val() == null) {
                            $('#btn-cancel').toggleClass('d-none')
                            $('#btn-save').val('update')
                        }

                        $('#id').val(data.id)
                        $('#name').val(data.name)
                        $('#btn-save').html('Atualizar')


                    }
                }
            ).fail(function (xhr, status, error) {
                let message = "Erro desconhecido";
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    message = xhr.responseJSON.message;
                } else if (xhr.responseText) {
                    message = xhr.responseText;
                }
                alert("Erro ao buscar marca: " + message);
            })

        }

        function updateBrand(brandId) {
            $.ajax({
                url: `http://localhost:8080/api/brand/${brandId}`,
                method: 'PUT',
                data: $("#form").serialize()
            }).done(
                function () {
                    alert("Marca atualizada")
                    getBrands();
                }
            ).fail(function (xhr, status, error) {
                let message = "Erro desconhecido";
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    message = xhr.responseJSON.message;
                } else if (xhr.responseText) {
                    message = xhr.responseText;
                }
                alert("Erro ao salvar marca: " + message);
            })
        }

        function deleteBrand(brandId) {

            if(!confirm("Deseja deletar o item?")) {
                return
            }

            $.ajax({
                url: `http://localhost:8080/api/brand/delete/${brandId}`,
                method: "DELETE",
            }).done(
                function () {
                    alert("Marca Deletada")
                    getBrands();
                }
            ).fail(function (xhr, status, error) {
                let message = "Erro desconhecido";
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    message = xhr.responseJSON.message;
                } else if (xhr.responseText) {
                    message = xhr.responseText;
                }
                alert("Erro ao deletar marca: " + message);
            })
        }

        $(document).on("click", ".btn-update", function (event) {
            let brand = $(this).attr('brand')
            updateForm(brand)
        })

        $(document).on("click", ".btn-delete", function (event) {
            let brand = $(this).attr('brand')
            deleteBrand(brand)
        })

        $('#btn-save').on("click", function (event) {
            event.preventDefault()

            createBrand()
        })

        $('#btn-cancel').on("click", function (event) {
            $('#form input').val('')
            $(this).toggleClass('d-none')
            $('#btn-save').val('update')
        })

        $

        getBrands();
    </script>

</body>

</html>